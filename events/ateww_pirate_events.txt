namespace = ATE_WWW_PIRATE

#Good Pirate commander was discharged. (must be delayed to avoid scoping issues)
character_event = {
	#id = HFP.20803
	id = ATE_WWW_PIRATE.1
	hide_window = yes 
	is_triggered_only = yes
	

	trigger = {
		liege = { 
			character = FROMFROM
		}
	}

	immediate = {
			if = {
				limit = {
					martial = 12
					NOT = {  
						martial = 14
					}
				}
				liege = { change_variable = { which = byzantine_credibility_discharged_hero value = -1 } }
			}
			else_if = {
				limit = {
					martial = 14
					NOT = {  
						martial = 18
					}
				}
				liege = { change_variable = { which = byzantine_credibility_discharged_hero value = -2 } }
			}
			else_if = {
				limit = {  
					martial = 18
					NOT = {  
						martial = 20
					}
				}
				liege = { change_variable = { which = byzantine_credibility_discharged_hero value = -3 } }
			}
			else_if = {
				limit = {
					martial = 20
					NOT = {  
						martial = 24
					}
				}
				liege = { change_variable = { which = byzantine_credibility_discharged_hero value = -4 } }
			}
			else_if = {
				limit = {
					martial = 24
					NOT = {  
						martial = 28
					}
				}
				liege = { change_variable = { which = byzantine_credibility_discharged_hero value = -5 } }
			}
			else_if = {
				limit = {
					martial = 28
				}
				liege = { change_variable = { which = byzantine_credibility_discharged_hero value = -10 } }
			}
	}
}

#Clear variables on first start for the Emperor.
character_event = {
	#id = HFP.20804
	id = ATE_WWW_PIRATE.2
	hide_window = yes 
	is_triggered_only = yes
	

	trigger = {
		is_save_game = no
		has_law = succ_brethren_elective 
	}

	immediate = {
		set_variable = { which = byzantine_credibility_discharged_hero value = 0 }
		set_variable = { which = byzantine_credibility_appointed_sycophant value = 0 }
	}
}


#Poor Pirate commander was employed. (must be delayed to avoid scoping issues)
character_event = {
	#id = HFP.20805
	id = ATE_WWW_PIRATE.3
	hide_window = yes 
	is_triggered_only = yes
	

	trigger = {
		liege = { 
			character = FROMFROM
		}
	}

	immediate = {
		if = {
			limit = {
				liege = { 
					has_law = succ_brethren_elective 
					any_vassal = { 
						attribute_diff = { character = ROOT attribute = martial value = 5 } #Check if any other vassal or courtier has higher martial than current character. And check that said vassal or courtier would be a viable commander.
						NOR = { 
							has_job_title = job_marshal
							has_minor_title = title_commander
							character = PREVPREV
							primary_title = { temporary = yes } 
						}
						OR = {
							AND = {
								OR = {
									male_can_hold_minor_title_trigger = yes
									female_can_hold_minor_commander_title_trigger = yes
								}
								is_adult = yes
							}
							has_character_flag = special_marshal
						}
						prisoner = no
						NOT = { trait = incapable }
						NOT = { is_inaccessible_trigger = yes }
						NOT = { has_character_flag = guru }
						NOT = { has_character_modifier = refusing_to_lead }
						higher_real_tier_than = BARON #...Or potential commander is vassal...
					}
				}
			}
			if = {
				limit = {
					NOT = {  
						martial = 2
					}
				}
				liege = { change_variable = { which = byzantine_credibility_appointed_sycophant value = -10 } }
			}
			else_if = {
				limit = {
					martial = 2
					NOT = {  
						martial = 4
					}
				}
				liege = { change_variable = { which = byzantine_credibility_appointed_sycophant value = -5 } }
			}
			else_if = {
				limit = {
					martial = 4
					NOT = {  
						martial = 6
					}
				}
				liege = { change_variable = { which = byzantine_credibility_appointed_sycophant value = -4 } }
			}
			else_if = {
				limit = {
					martial = 6
					NOT = {  
						martial = 8
					}
				}
				liege = { change_variable = { which = byzantine_credibility_appointed_sycophant value = -3 } }
			}
			else_if = {
				limit = {
					martial = 8
					NOT = {  
						martial = 10
					}
				}
				liege = { change_variable = { which = byzantine_credibility_appointed_sycophant value = -2 } }
			}
		}
	}
}

# (from on_death)
character_event = {
	id = ATE_WWW_PIRATE.4

	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			death_execution_trigger = yes
			death_reason = death_duel
			death_reason = death_battle
			death_sacrificed_trigger = yes
		}
		killer = { always = yes }
		killer = {
			religion_group = pirate
			NOT = { has_character_flag = killed_a_man }
		}
	}
	
	immediate = {
		killer = {
			set_character_flag = killed_a_man
		}
	}
}


narrative_event = {
	id = ATE_WWW_PIRATE.5
	title = EVTNAME_pirate_king
	desc = EVTDESC_pirate_king
	picture = GFX_evt_pirate_ship 
	border = GFX_event_narrative_frame_religion

	major = yes

	is_triggered_only = yes
	
	#trigger = {
	#	NOT = { has_global_flag = pirate_king }
	#}
	
	option = {
		name = EVTOPTA_pirate_king
		trigger = {
			religion = brethren 
			NOT = { has_landed_title = k_pirate_kingdom }
		}
	}
	
	option = {
		name = EVTOPTB_pirate_king
		trigger = {
			NOT = { religion = brethren }
		}
	}
	
	option = {
		name = EVTOPTC_pirate_king
		trigger = {
			religion = brethren 
			has_landed_title = k_pirate_kingdom
		}
	}
}